<html>
  <head>
    <title>Crazy Eights Game</title>
    <style>
      .DIAMONDS {
        color: red;
      }

      .HEARTS {
        color: red;
      }
    </style>
  </head>

  <body>
    <h1>{{ name }}</h1>
    <div>Top Card: <span class="{{ top_card_suit }}">{{ top_card }}</span>{{ top_card_extra }}</div>
    {% if recent_moves %}
    <div id="recent-moves">
      <div>Recent Moves:</div>
      <ul>
        {% for move_preamble, move_text, action in recent_moves %}
        <li>
          {{ move_preamble }} <span class="{{ action }}">{{ move_text }}</span>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    <div>
      Players:
      <ul id="player">
        {% for player, count, did_win in ordered_players %}
        <li>{{ player }} ({{ count }} card{% if count != 1 %}s{% endif %}{% if did_win %}, <strong>WINNER</strong>{% endif %})</li>
        {% endfor %}
      </ul>
    </div>
    <div>Your cards:</div>
    <ul id="cards">
      {% for value, action, as_display, can_play in moves %}
      <li>
        {% if can_play %}
        <form
          action="/play/{{ player_uuid }}/{{ value }}/{{ action }}"
          method="post"
        >
          <span class="{{ action }}">{{ as_display }}</span>
          <button type="submit" formmethod="post">Play</button>
        </form>
        {% else %}
        <span class="{{ action }}">{{ as_display }}</span>
        {% endif %}
      </li>
      {% endfor %}
    </ul>

    <script language="JavaScript" type="text/javascript">
      function checkReload() {
        const currentTurn = {{ current_turn }};
        const url = `${window.location.origin}/active`;
        fetch(url)
          .then(response => response.json())
          .then(response => {
            if (response.turn !== currentTurn) {
              window.location.reload(false);
            };
        }, error => {
            console.error(error);
        });
      }

      setInterval(checkReload, 5000);
    </script>
  </body>
</html>
